paths:
  /api/carts:
    post:
      summary: Create a new cart.
      tags:
        - Carts
      responses:
        "200":
          description: The cart was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Carts'
        "500":
          description: Internal server error, usually generated by failed connection to the DB.
  /api/carts/{cid}/products/{pid}:
    post:
      summary: Add product to cart.
      tags:
        - Carts
      parameters:
        - name: cid
          in: path
          required: true
          description: cart Id
          schema:
            type: string
        - name: pid
          in: path
          required: true
          description: Product Id
          schema:
            type: string
        - name: token
          in: header
          description: Token de autenticaci√≥n en API.
          required: true
          schema:
            type: string
            format: bearerToken
      responses:
        "200":
          description: The product was successfully added to the cart.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/successfully'
        "400":
          description: The product could not be saved in the cart, probably an error of the incorrectly entered pid, cid or token.
        "500":
          description: Internal server error, usually generated by failed connection to the DB.
  /api/carts/{cid}/purchase:
    post:
      summary: The purchase receipt is generated.
      tags:
        - Carts
      parameters:
        - name: cid
          in: path
          required: true
          description: cart Id.
          schema:
            type: string
      responses:
        "200":
          description: The purchase was processed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurchaseResponse'
        "401":
          description: Unauthorized user.
        "500":
          description: Error at checkout.

components:
  schemas:
    Carts:
      type: object
      properties:
        _id:
          type: ObjectId
          description: Id autogenerated by mongo.
        products:
          type: array
          description: empty array
      example:
        _id: "64d793fec389884072e10d9e"
        products: []

    successfully:
      type: object
      properties:
        data:
          type: object
          properties:
            acknowledged:
              type: boolean
            modifiedCount:
              type: integer
            upsertedId:
              type: null
            upsertedCount:
              type: integer
            matchedCount:
              type: integer
      example:
        data:
          acknowledged: true
          modifiedCount: 1
          upsertedId: null
          upsertedCount: 0
          matchedCount: 1

    Ticket:
      type: object
      properties:
        code:
          type: string
        purchase_datetime:
          type: string
        amount:
          type: number
        purchaser:
          type: string
        _id:
          type: string
        __v:
          type: number
      example:
        code: "d5bd53fb-3e17-4dbf-a22f-e486af3f2ce1"
        purchase_datetime: "12/8/2023, 17:45:11"
        amount: 10284
        purchaser: "fara@gmail.com"
        _id: "64d7ef572f3fbe5d09aa5049"
        __v: 0

    PurchaseResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            status:
              type: string
            result:
              type: object
              properties:
                ticket:
                  $ref: '#/components/schemas/Ticket'
                payload:
                  type: object
                  properties:
                    acknowledged:
                      type: boolean
                    modifiedCount:
                      type: integer
                    upsertedId:
                      type: null
                    upsertedCount:
                      type: integer
                    matchedCount:
                      type: integer
                outStock:
                  type: array
                  items:
                    type: object